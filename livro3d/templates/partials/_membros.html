<div class="container mt-5">
    <h2>Membros Cadastrados</h2>
    
    {% if membros %}
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>Foto</th>
                    <th>Nome</th>
                    <th>Cargo</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for membro in membros %}
                <tr>
                    <td>
                        {% if membro.foto %}
                            <img src="{{ membro.foto.url }}" alt="{{ membro.nome }}" 
                                 class="img-thumbnail" style="width: 80px; height: 80px; object-fit: cover;">
                        {% else %}
                            <span class="text-muted">Sem foto</span>
                        {% endif %}
                    </td>
                    <td>{{ membro.nome }}</td>
                    <td>{{ membro.cargo }}</td>
                    <td>
                        <div class="btn-group" role="group">
                            <!-- Botão Editar -->
                            <button type="button" class="btn btn-warning btn-sm" 
                                    data-bs-toggle="modal" 
                                    data-bs-target="#editarMembroModal"
                                    data-membro-id="{{ membro.id }}"
                                    data-membro-nome="{{ membro.nome }}"
                                    data-membro-cargo="{{ membro.cargo }}">
                                <i class="bi bi-pencil"></i> Editar
                            </button>
                            
                            <!-- Botão Excluir com confirmação -->
                            <form method="post" action="{% url 'excluir_membro' membro.id %}" 
                                  class="d-inline ms-3" 
                                  onsubmit="return confirm('Tem certeza que deseja excluir este membro?');">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger btn-sm">
                                    <i class="bi bi-trash"></i> Excluir
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-info">
        Nenhum membro cadastrado ainda.
    </div>
    {% endif %}
</div>

<!-- Modal para Editar Membro -->
<div class="modal fade" id="editarMembroModal" tabindex="-1" aria-labelledby="editarMembroModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editarMembroModalLabel">Editar Membro</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" enctype="multipart/form-data" id="formEditarMembro">
                <div class="modal-body">
                    {% csrf_token %}
                    <input type="hidden" name="membro_id" id="membroId">
                    
                    <div class="mb-3">
                        <label for="nome" class="form-label">Nome</label>
                        <input type="text" class="form-control" id="nome" name="nome" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="cargo" class="form-label">Cargo</label>
                        <input type="text" class="form-control" id="cargo" name="cargo" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="foto" class="form-label">Foto (deixe em branco para manter a atual)</label>
                        <input type="file" class="form-control" id="foto" name="foto" accept="image/*">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" name="salvar_membro" class="btn btn-primary">Salvar Alterações</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- JavaScript para o Modal -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const editarMembroModal = document.getElementById('editarMembroModal');
    
    editarMembroModal.addEventListener('show.bs.modal', function(event) {
        const button = event.relatedTarget;
        
        const membroId = button.getAttribute('data-membro-id');
        const membroNome = button.getAttribute('data-membro-nome');
        const membroCargo = button.getAttribute('data-membro-cargo');
        
        document.getElementById('membroId').value = membroId;
        document.getElementById('nome').value = membroNome;
        document.getElementById('cargo').value = membroCargo;
        
        document.getElementById('editarMembroModalLabel').textContent = 'Editar Membro: ' + membroNome;
    });
    
    editarMembroModal.addEventListener('hidden.bs.modal', function() {
        document.getElementById('formEditarMembro').reset();
        document.getElementById('membroId').value = '';
    });
});
</script>